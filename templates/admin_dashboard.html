{% extends 'base.html' %}

{% block content %}
    <h2>Admin Dashboard</h2>

    <div class="dashboard-summary-cards">
        <div class="summary-card total-students">
            <h3>Total Students</h3>
            <p>{{ total_students }}</p>
        </div>
        <div class="summary-card paid-students">
            <h3>Paid Students</h3>
            <p>{{ paid_students_count }}</p>
        </div>
        <div class="summary-card defaulters">
            <h3>Defaulters</h3>
            <p>{{ defaulters_count }}</p>
        </div>
        <div class="summary-card partially-paid">
            <h3>Partially Paid</h3>
            <p>{{ partially_paid_count }}</p>
        </div>
        <div class="summary-card expected-revenue">
            <h3>Expected Revenue</h3>
            <p>₦{{ total_expected_revenue | format_currency }}</p>
        </div>
        <div class="summary-card received-revenue">
            <h3>Received Revenue</h3>
            <p>₦{{ total_received_revenue | format_currency }}</p>
        </div>
        <div class="summary-card outstanding-revenue">
            <h3>Outstanding Revenue</h3>
            <p>₦{{ total_outstanding_revenue | format_currency }}</p>
        </div>
    </div>

    <hr style="margin: 30px 0; border: 0; border-top: 1px solid var(--border-color);">

    <div class="dashboard-details">
        {% if outstanding_defaulter_students %}
            <h3>Students with Full Outstanding Fees (Defaulters)</h3>
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Reg. No.</th>
                            <th>Name</th>
                            <th>Class</th>
                            <th>Term</th>
                            <th>Academic Year</th>
                            <th>Outstanding Amount (₦)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for student in outstanding_defaulter_students %}
                            <tr>
                                <td>{{ student.reg_no }}</td>
                                <td>{{ student.name }}</td>
                                <td>{{ student.class }}</td>
                                <td>{{ student.term }}</td>
                                <td>{{ student.academic_year }}</td>
                                <td class="defaulter-cell">₦{{ student.outstanding_amount | format_currency }}</td>
                                <td><a href="{{ url_for('student_details', student_id=student.reg_no) }}" class="btn btn-info" style="padding: 8px 15px; font-size: 0.8em; background-color: #17a2b8;">View</a></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>No students with full outstanding fees.</p>
        {% endif %}

        {% if outstanding_partially_paid_students %}
            <h3>Students with Partially Paid Fees</h3>
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Reg. No.</th>
                            <th>Name</th>
                            <th>Class</th>
                            <th>Term</th>
                            <th>Academic Year</th>
                            <th>Outstanding Amount (₦)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for student in outstanding_partially_paid_students %}
                            <tr>
                                <td>{{ student.reg_no }}</td>
                                <td>{{ student.name }}</td>
                                <td>{{ student.class }}</td>
                                <td>{{ student.term }}</td>
                                <td>{{ student.academic_year }}</td>
                                <td class="defaulter-cell">₦{{ student.outstanding_amount | format_currency }}</td> {# Using defaulter-cell for any outstanding #}
                                <td><a href="{{ url_for('student_details', student_id=student.reg_no) }}" class="btn btn-info" style="padding: 8px 15px; font-size: 0.8em; background-color: #17a2b8;">View</a></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>No students with partially paid fees.</p>
        {% endif %}

        <h3>Recent Payments</h3>
        {% if recent_payments %}
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Payment Date</th>
                            <th>Student Name</th>
                            <th>Term</th>
                            <th>Academic Year</th>
                            <th>Amount Paid (₦)</th>
                            <th>Recorded By</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for payment in recent_payments %}
                            <tr>
                                <td>{{ payment.payment_date }}</td>
                                <td>{{ payment.name }}</td>
                                <td>{{ payment.term }}</td>
                                <td>{{ payment.academic_year }}</td>
                                <td>₦{{ payment.amount_paid | format_currency }}</td>
                                <td>{{ payment.recorded_by | d('N/A') }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>No recent payments recorded.</p>
        {% endif %}
    </div>
{% endblock %}

